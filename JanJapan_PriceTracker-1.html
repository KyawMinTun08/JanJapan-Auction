<!DOCTYPE html>
<html lang="my">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JAN JAPAN â€” Auction Price Tracker</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', Arial, sans-serif; background: #0f172a; color: #e2e8f0; min-height: 100vh; }

  .header { background: linear-gradient(135deg, #1B3A6B, #2563eb); padding: 18px 24px; display: flex; align-items: center; gap: 16px; }
  .header h1 { font-size: 1.4rem; color: #FFD700; font-weight: 800; letter-spacing: 1px; }
  .header p  { font-size: 0.8rem; color: #93c5fd; margin-top: 2px; }
  .badge { background: #FFD700; color: #1B3A6B; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; margin-left: auto; white-space: nowrap; }

  .main { max-width: 1200px; margin: 0 auto; padding: 20px 16px; }

  /* Stats Row */
  .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px; }
  .stat-card { background: #1e293b; border-radius: 12px; padding: 16px; text-align: center; border: 1px solid #334155; }
  .stat-card .num { font-size: 1.8rem; font-weight: 800; color: #FFD700; }
  .stat-card .lbl { font-size: 0.75rem; color: #94a3b8; margin-top: 4px; }

  /* Tabs */
  .tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
  .tab { padding: 8px 20px; border-radius: 8px; border: 1px solid #334155; background: #1e293b; color: #94a3b8; cursor: pointer; font-size: 0.85rem; font-weight: 600; transition: all .2s; }
  .tab.active { background: #2563eb; border-color: #2563eb; color: #fff; }

  /* Cards */
  .card { background: #1e293b; border-radius: 14px; padding: 20px; border: 1px solid #334155; margin-bottom: 20px; }
  .card h2 { font-size: 1rem; font-weight: 700; color: #FFD700; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }

  /* Search */
  .search-row { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 16px; }
  .search-row input, .search-row select { flex: 1; min-width: 140px; padding: 10px 14px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: #e2e8f0; font-size: 0.9rem; }
  .search-row input::placeholder { color: #475569; }
  .btn { padding: 10px 20px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; font-size: 0.85rem; }
  .btn-blue { background: #2563eb; color: #fff; }
  .btn-green { background: #16a34a; color: #fff; }
  .btn-red { background: #dc2626; color: #fff; }

  /* Table */
  table { width: 100%; border-collapse: collapse; font-size: 0.82rem; }
  th { background: #1B3A6B; color: #FFD700; padding: 10px 8px; text-align: center; font-weight: 700; position: sticky; top: 0; }
  td { padding: 9px 8px; text-align: center; border-bottom: 1px solid #1e293b; }
  tr:hover td { background: #0f172a; }
  tr:nth-child(even) td { background: #162032; }
  .pill { display: inline-block; padding: 2px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; }
  .pill-green { background: #14532d; color: #4ade80; }
  .pill-red   { background: #450a0a; color: #f87171; }
  .pill-gray  { background: #1e293b; color: #94a3b8; }
  .price-up   { color: #4ade80; font-weight: 700; }
  .price-down { color: #f87171; font-weight: 700; }
  .price-same { color: #94a3b8; }

  /* Chart area */
  .chart-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .chart-box { background: #0f172a; border-radius: 10px; padding: 16px; }
  canvas { max-height: 280px; }

  /* Add price form */
  .form-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
  .form-grid input, .form-grid select { padding: 10px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: #e2e8f0; font-size: 0.9rem; width: 100%; }
  .form-row { display: flex; gap: 10px; margin-top: 10px; }

  /* Trend indicator */
  .trend-big { font-size: 1.5rem; }

  @media(max-width: 700px) {
    .stats { grid-template-columns: repeat(2, 1fr); }
    .chart-grid { grid-template-columns: 1fr; }
    .form-grid { grid-template-columns: 1fr 1fr; }
  }
</style>
</head>
<body>

<div class="header">
  <div>
    <h1>ğŸš— JAN JAPAN AUCTION</h1>
    <p>Maesot Freezone â€” á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸ Tracker</p>
  </div>
  <div class="badge">27 Feb 2026</div>
</div>

<div class="main">

  <!-- Stats -->
  <div class="stats">
    <div class="stat-card"><div class="num" id="s-total">43</div><div class="lbl">á€€á€¬á€¸á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸</div></div>
    <div class="stat-card"><div class="num" id="s-priced">0</div><div class="lbl">á€ˆá€±á€¸á€›á€•á€¼á€®á€¸</div></div>
    <div class="stat-card"><div class="num" id="s-entries">0</div><div class="lbl">History á€™á€¾á€á€ºá€á€™á€ºá€¸</div></div>
    <div class="stat-card"><div class="num" id="s-models">12</div><div class="lbl">Model á€¡á€™á€»á€­á€¯á€¸á€¡á€…á€¬á€¸</div></div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <div class="tab active" onclick="showTab('search')">ğŸ” á€€á€¬á€¸á€›á€¾á€¬</div>
    <div class="tab" onclick="showTab('chart')">ğŸ“ˆ á€ˆá€±á€¸á€€á€¼á€Šá€·á€º</div>
    <div class="tab" onclick="showTab('add')">â• á€ˆá€±á€¸á€‘á€Šá€·á€º</div>
    <div class="tab" onclick="showTab('history')">ğŸ“‹ á€™á€¾á€á€ºá€á€™á€ºá€¸</div>
  </div>

  <!-- TAB: SEARCH -->
  <div id="tab-search">
    <div class="card">
      <h2>ğŸ” á€€á€¬á€¸á€›á€¾á€¬</h2>
      <div class="search-row">
        <input type="text" id="q-chassis" placeholder="Chassis (e.g. NT32-504837)">
        <input type="text" id="q-model" placeholder="Model (e.g. X-TRAIL, WISH, FIT)">
        <select id="q-year">
          <option value="">Year á€¡á€¬á€¸á€œá€¯á€¶á€¸</option>
        </select>
        <button class="btn btn-blue" onclick="doSearch()">á€›á€¾á€¬</button>
      </div>
      <div style="overflow-x:auto;">
        <table>
          <thead>
            <tr><th>Chassis</th><th>Model</th><th>Color</th><th>Year</th><th>Latest Price</th><th>Change</th><th>Status</th></tr>
          </thead>
          <tbody id="search-tbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- TAB: CHART -->
  <div id="tab-chart" style="display:none;">
    <div class="card">
      <h2>ğŸ“ˆ á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸ Chart</h2>
      <div class="search-row" style="margin-bottom:16px;">
        <select id="chart-model" onchange="updateCharts()">
          <option value="X-TRAIL">X-TRAIL</option>
          <option value="WISH">WISH</option>
          <option value="FIT">FIT</option>
          <option value="CROWN">CROWN</option>
          <option value="HIACE VAN">HIACE VAN</option>
        </select>
        <select id="chart-year" onchange="updateCharts()">
          <option value="">Year á€¡á€¬á€¸á€œá€¯á€¶á€¸</option>
        </select>
      </div>
      <div class="chart-grid">
        <div class="chart-box">
          <p style="color:#94a3b8;font-size:.8rem;margin-bottom:8px;">Chassis á€á€½á€² â€” á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸á€á€…á€ºá€€á€¼á€±á€¬á€„á€ºá€¸á€á€»á€„á€ºá€¸</p>
          <canvas id="lineChart"></canvas>
        </div>
        <div class="chart-box">
          <p style="color:#94a3b8;font-size:.8rem;margin-bottom:8px;">Model á€•á€»á€™á€ºá€¸á€™á€»á€¾á€ˆá€±á€¸ (á€á€…á€ºá€œá€á€»á€„á€ºá€¸)</p>
          <canvas id="avgChart"></canvas>
        </div>
      </div>
      <div id="trend-summary" style="margin-top:16px; display:grid; grid-template-columns:repeat(3,1fr); gap:12px;"></div>
    </div>
  </div>

  <!-- TAB: ADD PRICE -->
  <div id="tab-add" style="display:none;">
    <div class="card">
      <h2>â• á€ˆá€±á€¸á€¡á€á€…á€ºá€‘á€Šá€·á€º</h2>
      <p style="color:#94a3b8;font-size:.85rem;margin-bottom:16px;">Messenger á€™á€¾ á€ˆá€±á€¸á€›á€á€­á€¯á€„á€ºá€¸ á€’á€®á€™á€¾á€¬ á€‘á€Šá€·á€ºá€•á€« â†’ Chart á€á€»á€€á€ºá€á€»á€„á€ºá€¸ update á€–á€¼á€…á€º</p>
      <div class="form-grid">
        <input type="text" id="f-chassis" placeholder="Chassis *" list="chassis-list">
        <datalist id="chassis-list"></datalist>
        <input type="text" id="f-model" placeholder="Model *" list="model-list">
        <datalist id="model-list"></datalist>
        <select id="f-color">
          <option value="">Color</option>
          <option>WHITE</option><option>PEARL WHITE</option><option>BLACK</option>
          <option>SILVER</option><option>BLUE</option><option>GREEN</option><option>LIGHT BLUE</option>
        </select>
        <input type="number" id="f-year" placeholder="Year (e.g. 2015)">
        <input type="number" id="f-price" placeholder="á€ˆá€±á€¸ THB *">
        <input type="text" id="f-date" placeholder="á€›á€€á€ºá€…á€½á€² (DD/MM/YYYY)">
        <input type="text" id="f-location" placeholder="Location" value="Maesot FZ">
      </div>
      <div class="form-row">
        <button class="btn btn-green" onclick="addPrice()">âœ… á€ˆá€±á€¸á€‘á€Šá€·á€º</button>
        <button class="btn btn-blue" onclick="autoFill()">ğŸ” Chassis á€–á€¼á€„á€·á€º Auto Fill</button>
      </div>
      <div id="add-msg" style="margin-top:12px;"></div>
    </div>
  </div>

  <!-- TAB: HISTORY -->
  <div id="tab-history" style="display:none;">
    <div class="card">
      <h2>ğŸ“‹ á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸ á€™á€¾á€á€ºá€á€™á€ºá€¸á€¡á€¬á€¸á€œá€¯á€¶á€¸</h2>
      <div class="search-row">
        <input type="text" id="h-filter" placeholder="Model/Chassis á€–á€¼á€„á€·á€º á€…á€…á€º..." oninput="renderHistory()">
        <button class="btn btn-red" onclick="clearHistory()" style="white-space:nowrap;">ğŸ—‘ á€–á€»á€€á€º</button>
      </div>
      <div style="overflow-x:auto;">
        <table>
          <thead>
            <tr><th>#</th><th>Date</th><th>Chassis</th><th>Model</th><th>Year</th><th>Price (THB)</th><th>vs á€šá€á€„á€º</th><th>Location</th></tr>
          </thead>
          <tbody id="history-tbody"></tbody>
        </table>
      </div>
    </div>
  </div>

</div><!-- /main -->

<script>
// â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CARS = [
  {chassis:"MNH15-0039667",model:"ALPHARD",color:"WHITE",year:2005},
  {chassis:"CD48R-30111",model:"BIG THUMB",color:"GREEN",year:2005},
  {chassis:"FE82EEV500266",model:"CANTER",color:"WHITE",year:2002},
  {chassis:"FE84DV-550674",model:"CANTER",color:"BLUE",year:2008},
  {chassis:"FB70BB-512392",model:"CANTER GUTS",color:"WHITE",year:2005},
  {chassis:"MK35A-10405",model:"CONDOR",color:"PEARL WHITE",year:2006},
  {chassis:"JNCLSC0A1GU006386",model:"CONDOR",color:"WHITE",year:2016},
  {chassis:"GRS210-6004548",model:"CROWN",color:"PEARL WHITE",year:2013},
  {chassis:"GRS200-0001831",model:"CROWN",color:"WHITE",year:2008},
  {chassis:"GRS200-0020080",model:"CROWN",color:"WHITE",year:2008},
  {chassis:"GRS202-0002603",model:"CROWN",color:"WHITE",year:2008},
  {chassis:"XZC610-0001005",model:"DUTRO",color:"WHITE",year:2011},
  {chassis:"GE6-1539486",model:"FIT",color:"PEARL WHITE",year:2011},
  {chassis:"GP5-3032237",model:"FIT HYBRID",color:"PEARL WHITE",year:2014},
  {chassis:"GP1-1131390",model:"FIT HYBRID",color:"WHITE",year:2012},
  {chassis:"GP1-1049821",model:"FIT HYBRID",color:"PEARL WHITE",year:2011},
  {chassis:"GP7-1000970",model:"FIT SHUTTLE HYBRID",color:"PEARL WHITE",year:2015},
  {chassis:"GP2-3106770",model:"FIT SHUTTLE HYBRID",color:"SILVER",year:2013},
  {chassis:"FK61FM765129",model:"FUSO FIGHTER",color:"WHITE",year:2003},
  {chassis:"KDH201-0140123",model:"HIACE VAN",color:"WHITE",year:2014},
  {chassis:"S211P-0217418",model:"HIJET TRUCK",color:"WHITE",year:2013},
  {chassis:"S210P-2037788",model:"HIJET TRUCK",color:"WHITE",year:2005},
  {chassis:"S510P-0173458",model:"HIJET TRUCK",color:"WHITE",year:2017},
  {chassis:"UZJ100-0151432",model:"LAND CRUISER",color:"SILVER",year:2004},
  {chassis:"USF40-5006069",model:"LEXUS LS",color:"WHITE",year:2006},
  {chassis:"WVWZZZ16ZDM638030",model:"NEW BEETLE",color:"BLACK",year:2013},
  {chassis:"ZRR75-0068964",model:"NOAH",color:"PEARL WHITE",year:2010},
  {chassis:"V98W-0300140",model:"PAJERO",color:"PEARL WHITE",year:2010},
  {chassis:"S211U-0000227",model:"PIXIS TRUCK",color:"WHITE",year:2011},
  {chassis:"FC7JKY-14910",model:"RANGER",color:"BLUE",year:2011},
  {chassis:"NCP165-0001505",model:"SUCCEED VAN",color:"PEARL WHITE",year:2014},
  {chassis:"NCP59-0012188",model:"SUCCEED WAGON",color:"SILVER",year:2005},
  {chassis:"FV50JJX-530670",model:"SUPER GREAT",color:"BLACK",year:2004},
  {chassis:"CG5ZA-30374",model:"UD",color:"PEARL WHITE",year:2014},
  {chassis:"CD5ZA-30191",model:"UD",color:"SILVER",year:2014},
  {chassis:"CG4ZA-01338",model:"UD",color:"LIGHT BLUE",year:2006},
  {chassis:"ZGE22-0005423",model:"WISH",color:"BLACK",year:2011},
  {chassis:"ZGE20-0010786",model:"WISH",color:"PEARL WHITE",year:2009},
  {chassis:"ZGE25-0015283",model:"WISH",color:"WHITE",year:2011},
  {chassis:"NT32-504837",model:"X-TRAIL",color:"BLACK",year:2014},
  {chassis:"NT32-531693",model:"X-TRAIL",color:"BLACK",year:2015},
  {chassis:"NT31-316873",model:"X-TRAIL",color:"PEARL WHITE",year:2013},
  {chassis:"NT32-508661",model:"X-TRAIL",color:"PEARL WHITE",year:2015},
];

// Sample history
const SAMPLE = [
  {date:"01/10/2025",chassis:"NT32-504837",model:"X-TRAIL",color:"BLACK",year:2014,price:160000,location:"Maesot FZ"},
  {date:"15/10/2025",chassis:"NT32-531693",model:"X-TRAIL",color:"BLACK",year:2015,price:175000,location:"Maesot FZ"},
  {date:"01/11/2025",chassis:"NT31-316873",model:"X-TRAIL",color:"PEARL WHITE",year:2013,price:145000,location:"Maesot FZ"},
  {date:"15/11/2025",chassis:"NT32-508661",model:"X-TRAIL",color:"PEARL WHITE",year:2015,price:170000,location:"Maesot FZ"},
  {date:"01/12/2025",chassis:"NT32-504837",model:"X-TRAIL",color:"BLACK",year:2014,price:155000,location:"Maesot FZ"},
  {date:"15/12/2025",chassis:"NT32-531693",model:"X-TRAIL",color:"BLACK",year:2015,price:168000,location:"Maesot FZ"},
  {date:"01/01/2026",chassis:"NT31-316873",model:"X-TRAIL",color:"PEARL WHITE",year:2013,price:140000,location:"Maesot FZ"},
  {date:"15/01/2026",chassis:"NT32-508661",model:"X-TRAIL",color:"PEARL WHITE",year:2015,price:165000,location:"Maesot FZ"},
  {date:"01/02/2026",chassis:"NT32-504837",model:"X-TRAIL",color:"BLACK",year:2014,price:150000,location:"Maesot FZ"},
  {date:"27/02/2026",chassis:"NT32-531693",model:"X-TRAIL",color:"BLACK",year:2015,price:150000,location:"Maesot FZ"},
  {date:"27/02/2026",chassis:"NT31-316873",model:"X-TRAIL",color:"PEARL WHITE",year:2013,price:125000,location:"Maesot FZ"},
  {date:"27/02/2026",chassis:"NT32-508661",model:"X-TRAIL",color:"PEARL WHITE",year:2015,price:150000,location:"Maesot FZ"},
  {date:"01/11/2025",chassis:"ZGE25-0015283",model:"WISH",color:"WHITE",year:2011,price:95000,location:"Maesot FZ"},
  {date:"01/12/2025",chassis:"ZGE25-0015283",model:"WISH",color:"WHITE",year:2011,price:92000,location:"Maesot FZ"},
  {date:"01/01/2026",chassis:"ZGE25-0015283",model:"WISH",color:"WHITE",year:2011,price:90000,location:"Maesot FZ"},
  {date:"27/02/2026",chassis:"ZGE25-0015283",model:"WISH",color:"WHITE",year:2011,price:88000,location:"Maesot FZ"},
  {date:"01/11/2025",chassis:"GE6-1539486",model:"FIT",color:"PEARL WHITE",year:2011,price:65000,location:"Maesot FZ"},
  {date:"01/12/2025",chassis:"GE6-1539486",model:"FIT",color:"PEARL WHITE",year:2011,price:63000,location:"Maesot FZ"},
  {date:"01/01/2026",chassis:"GE6-1539486",model:"FIT",color:"PEARL WHITE",year:2011,price:62000,location:"Maesot FZ"},
  {date:"27/02/2026",chassis:"GE6-1539486",model:"FIT",color:"PEARL WHITE",year:2011,price:61000,location:"Maesot FZ"},
];

let priceHistory = [...SAMPLE];
let lineChartObj = null, avgChartObj = null;

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function init() {
  // Year dropdown
  const years = [...new Set(CARS.map(c=>c.year))].sort((a,b)=>b-a);
  ['q-year','chart-year','f-year'].forEach(id=>{
    const el = document.getElementById(id);
    if(el && el.tagName==='SELECT') years.forEach(y=>{
      const o=document.createElement('option'); o.value=y; o.text=y; el.appendChild(o);
    });
  });
  // Datalists
  const cd = document.getElementById('chassis-list');
  const md = document.getElementById('model-list');
  const models = [...new Set(CARS.map(c=>c.model))];
  CARS.forEach(c=>{ const o=document.createElement('option'); o.value=c.chassis; cd.appendChild(o); });
  models.forEach(m=>{ const o=document.createElement('option'); o.value=m; md.appendChild(o); });

  doSearch(); renderHistory(); updateStats();
  // default date
  document.getElementById('f-date').value = today();
}

function today(){
  const d=new Date(); 
  return `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`;
}

function fmt(n){ return n ? n.toLocaleString() : '-'; }

// â”€â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showTab(name){
  ['search','chart','add','history'].forEach(t=>{
    document.getElementById('tab-'+t).style.display = t===name?'':'none';
  });
  document.querySelectorAll('.tab').forEach((el,i)=>{
    el.classList.toggle('active', ['search','chart','add','history'][i]===name);
  });
  if(name==='chart') setTimeout(updateCharts,100);
}

// â”€â”€â”€ SEARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doSearch(){
  const qc = document.getElementById('q-chassis').value.toUpperCase();
  const qm = document.getElementById('q-model').value.toUpperCase();
  const qy = document.getElementById('q-year').value;
  const tb = document.getElementById('search-tbody');
  tb.innerHTML='';
  CARS.filter(c=>
    (!qc || c.chassis.includes(qc)) &&
    (!qm || c.model.includes(qm)) &&
    (!qy || c.year==qy)
  ).forEach(c=>{
    const hist = priceHistory.filter(h=>h.chassis===c.chassis).sort((a,b)=>b.price-a.price);
    const latest = hist.length ? hist[hist.length-1] : null;
    const prev   = hist.length>1 ? hist[hist.length-2] : null;
    const price  = latest ? latest.price : null;
    const diff   = (latest && prev) ? latest.price - prev.price : null;
    let diffHtml = '<span class="price-same">â€”</span>';
    if(diff!==null) diffHtml = diff>0 ? `<span class="price-up">â–² ${fmt(diff)}</span>` : diff<0 ? `<span class="price-down">â–¼ ${fmt(Math.abs(diff))}</span>` : '<span class="price-same">â€”</span>';
    const statusPill = price ? '<span class="pill pill-green">á€ˆá€±á€¸á€›á€•á€¼á€®</span>' : '<span class="pill pill-gray">á€ˆá€±á€¸á€™á€›á€á€±á€¸</span>';
    tb.innerHTML+=`<tr>
      <td style="font-size:.75rem;color:#94a3b8">${c.chassis}</td>
      <td style="font-weight:700;color:#e2e8f0">${c.model}</td>
      <td>${c.color}</td><td>${c.year}</td>
      <td style="font-weight:700;color:#FFD700">${price ? fmt(price)+' à¸¿' : 'â€”'}</td>
      <td>${diffHtml}</td><td>${statusPill}</td>
    </tr>`;
  });
}

// â”€â”€â”€ STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateStats(){
  const priced = new Set(priceHistory.map(h=>h.chassis)).size;
  document.getElementById('s-priced').textContent = priced;
  document.getElementById('s-entries').textContent = priceHistory.length;
  document.getElementById('s-total').textContent = CARS.length;
}

// â”€â”€â”€ ADD PRICE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function autoFill(){
  const ch = document.getElementById('f-chassis').value.trim().toUpperCase();
  const car = CARS.find(c=>c.chassis===ch);
  if(car){
    document.getElementById('f-model').value = car.model;
    document.getElementById('f-color').value = car.color;
    document.getElementById('f-year').value  = car.year;
    showMsg('âœ… Auto fill á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®','#4ade80');
  } else {
    showMsg('âš ï¸ Chassis á€™á€á€½á€±á€·á€•á€« â€” á€€á€­á€¯á€šá€ºá€á€­á€¯á€„á€º á€–á€¼á€Šá€·á€ºá€•á€«','#facc15');
  }
}

function addPrice(){
  const chassis  = document.getElementById('f-chassis').value.trim().toUpperCase();
  const model    = document.getElementById('f-model').value.trim().toUpperCase();
  const color    = document.getElementById('f-color').value.trim();
  const year     = parseInt(document.getElementById('f-year').value);
  const price    = parseInt(document.getElementById('f-price').value);
  const date     = document.getElementById('f-date').value.trim() || today();
  const location = document.getElementById('f-location').value.trim() || 'Maesot FZ';

  if(!chassis || !model || !price){ showMsg('â›” Chassis, Model, á€ˆá€±á€¸ á€‘á€Šá€·á€ºá€•á€«','#f87171'); return; }

  priceHistory.push({date,chassis,model,color,year,price,location});
  showMsg(`âœ… ${model} (${chassis}) â€” à¸¿${fmt(price)} á€‘á€Šá€·á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®!`,'#4ade80');
  updateStats(); renderHistory(); doSearch();
  document.getElementById('f-chassis').value='';
  document.getElementById('f-price').value='';
}

function showMsg(txt,color){
  const el=document.getElementById('add-msg');
  el.innerHTML=`<p style="color:${color};font-weight:700;font-size:.9rem;">${txt}</p>`;
  setTimeout(()=>el.innerHTML='',3000);
}

// â”€â”€â”€ HISTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderHistory(){
  const q = (document.getElementById('h-filter').value||'').toUpperCase();
  const tb = document.getElementById('history-tbody');
  const sorted = [...priceHistory].reverse();
  tb.innerHTML='';
  sorted.filter(h=> !q || h.chassis.includes(q)||h.model.includes(q)).forEach((h,i)=>{
    // find previous entry for same chassis
    const idx = priceHistory.indexOf(priceHistory.slice().reverse().find(x=>x===h));
    const earlier = priceHistory.filter(x=>x.chassis===h.chassis&&x!==h);
    const prev = earlier.length ? earlier[earlier.length-1] : null;
    let diffHtml='â€”';
    if(prev){
      const d=h.price-prev.price;
      diffHtml=d>0?`<span class="price-up">â–²${fmt(d)}</span>`:d<0?`<span class="price-down">â–¼${fmt(Math.abs(d))}</span>`:'â€”';
    }
    tb.innerHTML+=`<tr>
      <td style="color:#475569">${i+1}</td>
      <td style="font-size:.8rem">${h.date}</td>
      <td style="font-size:.75rem;color:#94a3b8">${h.chassis}</td>
      <td style="font-weight:700">${h.model}</td>
      <td>${h.year||'â€”'}</td>
      <td style="font-weight:700;color:#FFD700">à¸¿${fmt(h.price)}</td>
      <td>${diffHtml}</td>
      <td style="font-size:.8rem;color:#475569">${h.location}</td>
    </tr>`;
  });
}

function clearHistory(){
  if(confirm('Sample data á€¡á€¬á€¸á€œá€¯á€¶á€¸ á€–á€»á€€á€ºá€á€»á€„á€ºá€á€¬ á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?')){
    priceHistory=priceHistory.filter(h=>!SAMPLE.includes(h));
    renderHistory(); updateStats(); doSearch();
  }
}

// â”€â”€â”€ CHARTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const COLORS=['#3b82f6','#f59e0b','#10b981','#ef4444','#8b5cf6','#ec4899'];

function updateCharts(){
  const selModel = document.getElementById('chart-model').value;
  const selYear  = document.getElementById('chart-year').value;

  // Filter history for selected model
  let filtered = priceHistory.filter(h=>h.model===selModel && (!selYear||h.year==selYear));

  // Group by chassis
  const byChassis = {};
  filtered.forEach(h=>{
    if(!byChassis[h.chassis]) byChassis[h.chassis]=[];
    byChassis[h.chassis].push(h);
  });

  // All unique dates sorted
  const allDates=[...new Set(filtered.map(h=>h.date))].sort((a,b)=>{
    const pa=a.split('/').reverse().join(''), pb=b.split('/').reverse().join('');
    return pa>pb?1:-1;
  });

  // LINE CHART â€” per chassis
  const lineDatasets = Object.entries(byChassis).map(([ch,entries],i)=>{
    const sorted=entries.sort((a,b)=>{
      const pa=a.date.split('/').reverse().join(''), pb=b.date.split('/').reverse().join('');
      return pa>pb?1:-1;
    });
    return {
      label: ch+' ('+sorted[0].year+')',
      data: sorted.map(e=>e.price),
      borderColor: COLORS[i%COLORS.length],
      backgroundColor: COLORS[i%COLORS.length]+'33',
      tension:0.3, fill:true, pointRadius:5, pointHoverRadius:8,
    };
  });

  // labels = per-chassis sorted dates combined
  const lineLabels = Object.values(byChassis).flatMap(e=>e.map(x=>x.date));
  // Use allDates for x axis consistency
  if(lineChartObj) lineChartObj.destroy();
  lineChartObj = new Chart(document.getElementById('lineChart'),{
    type:'line',
    data:{labels: Object.values(byChassis)[0]?.sort((a,b)=>{const pa=a.date.split('/').reverse().join(''),pb=b.date.split('/').reverse().join('');return pa>pb?1:-1;}).map(e=>e.date)||[], datasets:lineDatasets},
    options:{responsive:true, plugins:{legend:{labels:{color:'#e2e8f0',font:{size:10}}}},
      scales:{x:{ticks:{color:'#94a3b8',font:{size:9}},grid:{color:'#1e293b'}},
              y:{ticks:{color:'#94a3b8',callback:v=>'à¸¿'+v.toLocaleString()},grid:{color:'#1e293b'}}}
    }
  });

  // AVG CHART â€” monthly average
  const months=['Oct-25','Nov-25','Dec-25','Jan-26','Feb-26'];
  const monthMap={'10/2025':'Oct-25','11/2025':'Nov-25','12/2025':'Dec-25','01/2026':'Jan-26','02/2026':'Feb-26'};
  const avgByMonth={};
  months.forEach(m=>avgByMonth[m]=[]);
  filtered.forEach(h=>{
    const parts=h.date.split('/');
    const key=parts[1]+'/'+parts[2];
    if(monthMap[key]) avgByMonth[monthMap[key]].push(h.price);
  });
  const avgData=months.map(m=>avgByMonth[m].length ? Math.round(avgByMonth[m].reduce((a,b)=>a+b)/avgByMonth[m].length) : null);

  if(avgChartObj) avgChartObj.destroy();
  avgChartObj = new Chart(document.getElementById('avgChart'),{
    type:'bar',
    data:{labels:months, datasets:[{
      label:'á€•á€»á€™á€ºá€¸á€™á€»á€¾á€ˆá€±á€¸ (THB)', data:avgData,
      backgroundColor:avgData.map((v,i)=>i===0||!avgData[i-1]?'#3b82f6':v>avgData[i-1]?'#10b981':'#ef4444'),
      borderRadius:6,
    }]},
    options:{responsive:true, plugins:{legend:{labels:{color:'#e2e8f0'}}},
      scales:{x:{ticks:{color:'#94a3b8'},grid:{color:'#1e293b'}},
              y:{ticks:{color:'#94a3b8',callback:v=>'à¸¿'+v.toLocaleString()},grid:{color:'#1e293b'}}}
    }
  });

  // Trend summary
  renderTrendSummary(selModel, avgData, months);
}

function renderTrendSummary(model, avgData, months){
  const valid = avgData.filter(v=>v);
  if(valid.length<2){document.getElementById('trend-summary').innerHTML='';return;}
  const first=valid[0], last=valid[valid.length-1];
  const change=last-first, pct=((change/first)*100).toFixed(1);
  const isUp=change>0;
  document.getElementById('trend-summary').innerHTML=`
    <div class="stat-card"><div class="num trend-big">${isUp?'ğŸ“ˆ':'ğŸ“‰'}</div><div class="lbl">${isUp?'á€ˆá€±á€¸á€á€€á€ºá€á€”á€±á€á€šá€º':'á€ˆá€±á€¸á€€á€»á€”á€±á€á€šá€º'}</div></div>
    <div class="stat-card"><div class="num" style="color:${isUp?'#4ade80':'#f87171'}">${isUp?'+':''}${pct}%</div><div class="lbl">${months[0]} á€™á€¾ ${months[months.length-1]} á€‘á€­</div></div>
    <div class="stat-card"><div class="num" style="color:#FFD700">à¸¿${last.toLocaleString()}</div><div class="lbl">á€”á€±á€¬á€€á€ºá€†á€¯á€¶á€¸á€•á€»á€™á€ºá€¸á€™á€»á€¾á€ˆá€±á€¸</div></div>
  `;
}

init();
</script>
</body>
</html>
